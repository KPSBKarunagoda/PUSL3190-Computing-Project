<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Analysis - PhishGuard</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body.dark-theme {
      padding-top: 80px;
      padding-bottom: 80px;
    }
    
    /* Header Navigation Styles */
    .top-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      padding: 0 30px;
      height: 60px;
    }
    
    .top-header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 100%;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
    }
    
    .logo {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .logo i {
      font-size: 1.4rem;
    }
    
    .header-nav {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .header-nav-item {
      color: var(--text-primary);
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 4px;
      font-size: 0.9rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .header-nav-item:hover {
      background-color: rgba(61, 133, 198, 0.1);
      color: var(--primary-color);
    }
    
    .header-nav-item.active {
      color: var(--primary-color);
      background-color: rgba(61, 133, 198, 0.1);
    }
    
    /* Updated Transparent Report Styling */
    .transparent-report {
      font-family: var(--font-main);
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    .scan-summary {
      margin-bottom: 20px;
      border-radius: 6px;
      padding: 15px;
      background-color: var(--card-bg);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    
    .scan-summary h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .scan-summary h3:before {
      content: "\f021";
      font-family: "Font Awesome 5 Free";
      font-weight: 900;
      font-size: 18px;
      color: var(--primary-color);
    }
    
    .risk-score {
      font-size: 16px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .risk-score-label {
      color: var(--text-secondary);
    }
    
    .risk-score span.high-risk {
      color: #f44336;
      font-weight: bold;
      font-size: 20px;
    }
    
    .risk-score span.medium-risk {
      color: #ff9800;
      font-weight: bold;
      font-size: 20px;
    }
    
    .risk-score span.low-risk {
      color: #4caf50;
      font-weight: bold;
      font-size: 20px;
    }
    
    .factors-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0 0 10px 0;
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 600;
    }
    
    .section-title i {
      color: var(--primary-color);
    }
    
    .risk-factors-list, .safe-factors-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .factor-card {
      background-color: var(--card-bg);
      border-radius: 6px;
      padding: 12px 15px;
      border-left-width: 3px;
      border-left-style: solid;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    
    .factor-card.critical {
      border-left-color: #d32f2f;
      background-color: rgba(211, 47, 47, 0.03);
    }
    
    .factor-card.high {
      border-left-color: #f44336;
      background-color: rgba(244, 67, 54, 0.03);
    }
    
    .factor-card.medium {
      border-left-color: #ff9800;
      background-color: rgba(255, 152, 0, 0.03);
    }
    
    .factor-card.low {
      border-left-color: #ffc107;
      background-color: rgba(255, 193, 7, 0.03);
    }
    
    .factor-card.safe {
      border-left-color: #4caf50;
      background-color: rgba(76, 175, 80, 0.03);
    }
    
    .factor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    
    .factor-name {
      font-weight: 600;
      font-size: 14px;
    }
    
    .impact-badge {
      font-size: 11px;
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 12px;
      color: white;
    }
    
    .impact-badge.critical {
      background-color: #d32f2f;
    }
    
    .impact-badge.high {
      background-color: #f44336;
    }
    
    .impact-badge.medium {
      background-color: #ff9800;
    }
    
    .impact-badge.low {
      background-color: #ffc107;
      color: #333;
    }
    
    .factor-explanation {
      color: var(--text-secondary);
      font-size: 13px;
      margin: 0;
    }
    
    .factor-value {
      color: var(--text-tertiary);
      font-size: 12px;
      margin-top: 5px;
    }
    
    .technical-section {
      margin-top: 20px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      overflow: hidden;
    }
    
    .technical-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background-color: var(--bg-secondary);
      cursor: pointer;
      user-select: none;
    }
    
    .technical-header h4 {
      margin: 0;
      font-size: 14px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .technical-header h4 i {
      color: var(--primary-color);
      font-size: 14px;
    }
    
    .toggle-icon {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-tertiary);
      transition: transform 0.2s;
    }
    
    .technical-content {
      display: none;
      padding: 0;
      background-color: var(--bg-secondary);
      overflow-x: auto;
    }
    
    .technical-section.expanded .technical-content {
      display: block;
    }
    
    .technical-section.expanded .toggle-icon {
      transform: rotate(45deg);
    }
    
    .features-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    
    .features-table th {
      text-align: left;
      padding: 8px 12px;
      background-color: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-weight: 600;
    }
    
    .features-table td {
      padding: 6px 12px;
      border-bottom: 1px solid var(--border-color-light);
    }
    
    .features-table tr.risk td:first-child {
      color: #f44336;
    }
    
    .features-table tr.safe td:first-child {
      color: #4caf50;
    }
    
    .features-table td.impact {
      text-align: center;
    }
    
    .table-note {
      font-size: 12px;
      color: var(--text-tertiary);
      padding: 10px 15px;
      margin: 0;
      font-style: italic;
    }
    
    .recommendations-section {
      margin-top: 25px;
      padding: 15px;
      border-radius: 6px;
      background-color: var(--card-bg);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    
    .recommendations-title {
      margin: 0 0 12px 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .recommendations-title i {
      color: var(--primary-color);
    }
    
    .security-advice {
      background-color: rgba(76, 175, 80, 0.05);
      border-left: 3px solid #4caf50;
      padding: 12px 15px;
      border-radius: 4px;
      color: var(--text-primary);
    }
    
    .security-advice.high-risk {
      background-color: rgba(244, 67, 54, 0.05);
      border-left: 3px solid #f44336;
    }
    
    .security-advice.medium-risk {
      background-color: rgba(255, 152, 0, 0.05);
      border-left: 3px solid #ff9800;
    }
    
    .security-advice p {
      margin: 0;
      font-weight: 500;
    }
    
    .safety-tips {
      padding-left: 20px;
      margin: 15px 0 0 0;
      color: var(--text-secondary);
      font-size: 13px;
    }
    
    .safety-tips li {
      margin-bottom: 5px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .factor-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .factor-impact {
        margin-top: 5px;
      }
    }
  </style>
</head>
<body class="dark-theme">
  <header class="top-header">
    <div class="top-header-content">
      <div class="logo-container">
        <a href="index.html" class="logo">
          <i class="fas fa-shield-alt"></i>
          <span>PhishGuard</span>
        </a>
      </div>
      <nav class="header-nav">
        <a href="dashboard.html" class="header-nav-item">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <a href="analyze.html" class="header-nav-item active">
          <i class="fas fa-search"></i> Analyze
        </a>
        <a href="settings.html" class="header-nav-item">
          <i class="fas fa-cog"></i> Settings
        </a>
      </nav>
    </div>
  </header>

  <div class="url-analysis-wrapper">
    <div class="analysis-header">
      <h1><i class="fas fa-search-shield"></i> URL Analysis</h1>
      <a href="dashboard.html" class="btn-new-analysis">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>

    <!-- URL Analysis Input Card -->
    <div class="analysis-card">
      <div class="input-section" id="analysis-input">
        <h2><i class="fas fa-shield-alt"></i> Check Any URL for Phishing Threats</h2>
        <p>Enter a website address below to analyze it for potential phishing indicators and security risks.</p>
        
        <div class="url-input-container">
          <i class="fas fa-globe url-icon"></i>
          <input type="url" id="url-input" class="url-input-field" placeholder="Enter URL (e.g., https://example.com)" autofocus>
          <button id="analyze-button" class="analyze-btn">
            <i class="fas fa-search"></i> Analyze
          </button>
        </div>
        
        <div id="input-error" class="error-message" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span>Please enter a valid URL (e.g., https://example.com)</span>
        </div>
        <div class="input-footer">
          <div class="input-tips">
            <i class="fas fa-info-circle"></i>
            <span>Tip: Include http:// or https:// for accurate analysis</span>
          </div>
        </div>
      </div>

      <!-- Loading Section -->
      <div id="loading-container" class="analysis-loading" style="display: none;">
        <div class="loading-animation">
          <div class="circle"></div>
          <div class="circle"></div>
        </div>
        <div class="loading-message">Analyzing URL</div>
        <div class="loading-details">We're checking for phishing indicators, malicious patterns, and security risks...</div>
        <div class="loading-progress">
          <div class="loading-progress-bar"></div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results-container" class="result-section" style="display: none;">
        <div class="result-header-banner">
          <div id="result-icon-container" class="result-icon-container icon-safe">
            <i id="result-icon" class="fas fa-shield-check"></i>
          </div>
          <div class="result-header-content">
            <h2 id="result-title">Analysis Complete</h2>
            <div id="analyzed-url" class="analyzed-url">URL: https://example.com</div>
          </div>
        </div>
              
        <div class="result-details">
          <div class="score-container">
            <div class="score-header">
              <div class="score-title">Risk Score</div>
              <div id="risk-score-value" class="score-value">0/100</div>
            </div>
            <div class="score-meter">
              <div id="score-fill" class="score-fill score-fill-safe" style="width: 0%"></div>
            </div>
            <div class="score-markers">
              <span>Low Risk</span>
              <span>Medium Risk</span>
              <span>High Risk</span>
            </div>
          </div>
          
          <div class="result-explanation">
            <p id="risk-explanation">This URL has been analyzed for phishing indicators.</p>
          </div>
          
          <div class="result-sections">
            <div class="result-summary">
              <div class="result-summary-header">
                <i class="fas fa-clipboard-list"></i>
                <h3>Analysis Summary</h3>
              </div>
              <div class="result-summary-content" id="analysis-summary">
                <!-- Summary content will be inserted here by JavaScript -->
              </div>
            </div>
          </div>
          
          <div class="result-footer">
            <button id="new-analysis" class="btn-new-analysis">
              <i class="fas fa-redo-alt"></i> Analyze Another URL
            </button>
            <a href="education.html" class="btn-learn-more">
              <i class="fas fa-book"></i> Learn More About Phishing
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Educational Resources Section -->
    <div class="education-container">
      <div class="education-header">
        <i class="fas fa-graduation-cap"></i>
        <h2>Educational Resources</h2>
      </div>
      <div class="education-content">
        <div id="education-content" class="education-placeholder">
          <i class="fas fa-shield-alt"></i>
          <h3>Phishing Protection Tips</h3>
          <p>Complete a URL analysis to get personalized educational content and learn how to protect yourself from common phishing techniques.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Don't forget to add the script tag before your main script -->
  <script src="js/ml-feature-explainer.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Check if user is logged in
      const token = localStorage.getItem('phishguardToken');
      if (!token) {
        window.location.href = 'login.html';
        return;
      }
      
      const urlInput = document.getElementById('url-input');
      const analyzeButton = document.getElementById('analyze-button');
      const inputError = document.getElementById('input-error');
      const loadingContainer = document.getElementById('loading-container');
      const resultsContainer = document.getElementById('results-container');
      const analysisInput = document.getElementById('analysis-input');
      const resultIcon = document.getElementById('result-icon');
      const resultIconContainer = document.getElementById('result-icon-container');
      const resultTitle = document.getElementById('result-title');
      const analyzedUrl = document.getElementById('analyzed-url');
      const scoreFill = document.getElementById('score-fill');
      const riskScoreValue = document.getElementById('risk-score-value');
      const riskExplanation = document.getElementById('risk-explanation');
      const analysisSummary = document.getElementById('analysis-summary');
      const newAnalysisButton = document.getElementById('new-analysis');
      
      // URL validation function
      function isValidUrl(url) {
        try {
          new URL(url);
          return true;
        } catch (e) {
          return false;
        }
      }
      
      // Handle analysis button click
      analyzeButton.addEventListener('click', async () => {
        inputError.style.display = 'none';
        const url = urlInput.value.trim();
        
        if (!url) {
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = 'Please enter a URL to analyze';
          return;
        }
        
        if (!isValidUrl(url)) {
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = 'Please enter a valid URL (e.g., https://example.com)';
          return;
        }
        
        analysisInput.style.display = 'none';
        loadingContainer.style.display = 'flex';
        resultsContainer.style.display = 'none';
        
        try {
          const response = await fetch('http://localhost:3000/analyze-url', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-auth-token': token
            },
            body: JSON.stringify({ 
              url: url,
              useSafeBrowsing: true
            })
          });
          
          if (!response.ok) {
            throw new Error('Failed to analyze URL');
          }
          
          const result = await response.json();
          displayResults(url, result);
        } catch (error) {
          console.error('Analysis error:', error);
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = error.message || 'Failed to analyze URL. Please try again.';
          analysisInput.style.display = 'block';
          loadingContainer.style.display = 'none';
        }
      });
      
      // Display analysis results
      function displayResults(url, result) {
        analyzedUrl.textContent = `URL: ${url}`;
        
        let score;
        if (result.risk_score > 1) {
          score = Math.min(100, result.risk_score);
        } else {
          score = result.risk_score * 100;
        }
        
        const displayScore = Math.round(score * 10) / 10;
        riskScoreValue.textContent = `${displayScore}/100`;
        
        const isHighRisk = score > 60;
        const isMediumRisk = score > 30;
        const mlPrediction = result.ml_result?.prediction || 0;
        
        if (result.is_phishing || (isHighRisk && mlPrediction === 1)) {
          resultIcon.className = 'fas fa-exclamation-triangle';
          resultIconContainer.className = 'result-icon-container icon-danger';
          resultTitle.textContent = 'Phishing Detected!';
          resultTitle.style.color = '#f44336';
          scoreFill.className = 'score-fill score-fill-danger';
        } else if (isMediumRisk || mlPrediction === 1) {
          resultIcon.className = 'fas fa-exclamation-circle';
          resultIconContainer.className = 'result-icon-container icon-warning';
          resultTitle.textContent = 'Caution Advised';
          resultTitle.style.color = '#ff9800';
          scoreFill.className = 'score-fill score-fill-medium';
        } else {
          resultIcon.className = 'fas fa-shield-check';
          resultIconContainer.className = 'result-icon-container icon-safe';
          resultTitle.textContent = 'Likely Safe';
          resultTitle.style.color = '#4caf50';
          scoreFill.className = 'score-fill score-fill-safe';
        }
        
        setTimeout(() => {
          scoreFill.style.width = `${score}%`;
        }, 300);
        
        try {
          const featureExplainer = new MLFeatureExplainer();
          
          // Debug to see what's in the result object
          console.log("Full analysis result:", result);
          
          // Fix: Check the actual content of result.features
          console.log("Raw features object:", result.features);
          
          // Fix the feature extraction - inspect all properties
          let features = {};
          
          if (result.ml_result && result.ml_result.features && Object.keys(result.ml_result.features).length > 0) {
            console.log("Found features in ml_result.features");
            features = result.ml_result.features;
          } else if (result.features && typeof result.features === 'object') {
            console.log("Found features in result.features, keys:", Object.keys(result.features));
            features = result.features;
            
            // Fix: If features is empty object but we're getting properties in the console
            // This handles cases where Object.keys() doesn't work due to non-enumerable properties
            if (Object.keys(features).length === 0) {
              console.log("Features object appears empty, trying direct access method");
              
              // Create a new object with all properties from result that look like features
              const featureProperties = [
                'domain_in_ip', 'tls_ssl_certificate', 'length_url', 'time_domain_activation',
                'url_shortened', 'qty_redirects', 'domain_google_index', 'qty_nameservers'
              ];
              
              // Check if any of these properties exist directly in result
              featureProperties.forEach(prop => {
                if (result[prop] !== undefined) {
                  features[prop] = result[prop];
                }
              });
              
              // Also check for reported features in the console logs
              if (url.includes('://') && /\d+\.\d+\.\d+\.\d+/.test(url)) {
                console.log("URL contains IP address, extracting from pattern");
                features.domain_in_ip = 1.0;
              }
              
              if (url.startsWith('http:')) {
                console.log("URL uses http (not https), marking as no SSL");
                features.tls_ssl_certificate = 0.0;
              }
            }
          } else {
            console.warn("No features found in response. Using IP address detection as fallback.");
            // Special case for IP addresses
            if (url.includes('://') && /\d+\.\d+\.\d+\.\d+/.test(url)) {
              features = {
                domain_in_ip: 1.0,
                tls_ssl_certificate: 0.0
              };
              console.log("Created fallback features for IP address:", features);
            }
          }
          
          // If we still have no features, extract what we can from the URL itself
          if (Object.keys(features).length === 0) {
            console.log("Still no features found, extracting basic ones from URL");
            features = {
              length_url: url.length,
              tls_ssl_certificate: url.startsWith('https:') ? 1.0 : 0.0
            };
            
            // Check for IP address in URL
            if (/\d+\.\d+\.\d+\.\d+/.test(url)) {
              features.domain_in_ip = 1.0;
            }
            
            // Check for dots in URL
            features.qty_dot_url = (url.match(/\./g) || []).length;
            
            // Check for hyphens in URL
            features.qty_hyphen_url = (url.match(/-/g) || []).length;
            
            console.log("Extracted basic features from URL:", features);
          }
          
          console.log("Final features for analysis:", features);
          
          const transparentHTML = featureExplainer.generateTransparentHTML(features, url, {
            risk_score: displayScore,
            is_phishing: result.is_phishing
          });
          
          riskExplanation.innerHTML = transparentHTML;
          riskExplanation.className = 'result-explanation transparent-report';
        } catch (error) {
          console.error('Error generating transparent explanation:', error);
          console.error('Result object structure:', JSON.stringify(result, null, 2));
          riskExplanation.textContent = result.risk_explanation || 'No detailed explanation available.';
        }
        
        let summaryHTML = '';
        
        if (result.is_phishing || (isHighRisk && mlPrediction === 1)) {
          summaryHTML = `
            <p><strong>High Risk Detected:</strong> Our analysis indicates this URL has multiple 
            characteristics commonly associated with phishing websites. The risk score 
            of ${displayScore}/100 suggests this may be an attempt to steal sensitive information.</p>
            
            ${result.safe_browsing_result?.threats ? '<p class="warning-message"><strong>Google Safe Browsing has flagged this website as dangerous.</strong></p>' : ''}
          `;
        } else if (isMediumRisk) {
          summaryHTML = `
            <p><strong>Moderate Risk Detected:</strong> This URL shows some suspicious characteristics
            but may not be a confirmed phishing site. The risk score of ${displayScore}/100 indicates
            caution is advised when interacting with this website.</p>
          `;
        } else {
          summaryHTML = `
            <p><strong>Low Risk Detected:</strong> Our analysis indicates this URL appears to be legitimate
            with a low risk score of ${displayScore}/100. No major phishing indicators were detected.</p>
          `;
        }
        
        analysisSummary.innerHTML = summaryHTML;
        loadEducationalContent(result);
        loadingContainer.style.display = 'none';
        resultsContainer.style.display = 'block';
      }
      
      // Add the loadEducationalContent function that uses the extracted features
      function loadEducationalContent(analysisResult) {
        const educationContent = document.getElementById('education-content');
        const features = analysisResult.ml_result?.features || {};
        
        // Determine risk level
        const riskLevel = analysisResult.is_phishing ? 'high' : 
                         (analysisResult.risk_score > 0.6 || analysisResult.risk_score > 60) ? 'high' :
                         (analysisResult.risk_score > 0.3 || analysisResult.risk_score > 30) ? 'medium' : 'low';
        
        // Build a list of security issues based on features
        const securityIssues = [];
        
        // Check for IP address in domain (a strong phishing indicator)
        if (features.domain_in_ip === 1.0) {
          securityIssues.push("IP address used instead of domain name");
        }
        
        // Check for SSL certificate
        if (features.tls_ssl_certificate === 0.0) {
          securityIssues.push("Missing SSL/TLS security certificate");
        }
        
        // Check for URL shortening
        if (features.url_shortened === 1.0) {
          securityIssues.push("URL shortening service used");
        }
        
        // Check for multiple redirects
        if (features.qty_redirects > 1) {
          securityIssues.push(`${features.qty_redirects} redirects detected`);
        }
        
        // Check for domain age
        if (features.time_domain_activation < 30 && features.time_domain_activation !== 0) {
          securityIssues.push(`Very new domain (only ${features.time_domain_activation} days old)`);
        }
        
        // Check if domain is indexed by search engines
        if (features.domain_google_index === 0) {
          securityIssues.push("Domain not indexed by search engines");
        }
        
        // Generate educational content with dynamic references to detected issues
        let educationalHTML = '';
        
        if (riskLevel === 'high') {
          educationalHTML = `
            <h3>Understanding High-Risk Phishing Sites</h3>
            <p>This URL shows multiple indicators commonly associated with phishing attacks:</p>
            ${securityIssues.length > 0 ? 
              `<ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
                ${securityIssues.map(issue => `<li>${issue}</li>`).join('')}
              </ul>` : ''}
            
            <p>Phishing sites often:</p>
            <ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
              <li>Mimic legitimate websites to steal your credentials</li>
              <li>Create a false sense of urgency to prompt immediate action</li>
              <li>Use suspicious domain names that look similar to legitimate sites</li>
              <li>Request sensitive personal information</li>
            </ul>
            <p><strong>Always verify a website's legitimacy before entering personal information.</strong></p>
          `;
        } else if (riskLevel === 'medium') {
          educationalHTML = `
            <h3>Understanding Medium-Risk Websites</h3>
            <p>This URL has some suspicious characteristics that warrant caution:</p>
            ${securityIssues.length > 0 ? 
              `<ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
                ${securityIssues.map(issue => `<li>${issue}</li>`).join('')}
              </ul>` : ''}
            
            <p>When dealing with medium-risk sites:</p>
            <ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
              <li>Verify the website's identity through other channels</li>
              <li>Check for HTTPS security and a valid certificate</li>
              <li>Be cautious about sharing personal information</li>
              <li>Look for contact information and legitimate privacy policies</li>
            </ul>
            <p><strong>Use caution and your best judgment when interacting with this site.</strong></p>
          `;
        } else {
          educationalHTML = `
            <h3>Safe Browsing Practices</h3>
            <p>This URL appears to be safe, but it's always good to follow these secure browsing habits:</p>
            <ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
              <li>Keep your browser and security software updated</li>
              <li>Use strong, unique passwords for different websites</li>
              <li>Enable two-factor authentication when available</li>
              <li>Be careful when clicking on links in emails or messages</li>
              <li>Check website URLs before entering personal information</li>
            </ul>
            <p><strong>Even on safe websites, always be mindful of the information you share online.</strong></p>
          `;
        }
        
        educationContent.innerHTML = educationalHTML;
      }
      
      newAnalysisButton.addEventListener('click', () => {
        urlInput.value = '';
        resultsContainer.style.display = 'none';
        loadingContainer.style.display = 'none';
        analysisInput.style.display = 'block';
        inputError.style.display = 'none';
        urlInput.focus();
      });
      
      urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          analyzeButton.click();
        }
      });
    });
  </script>
</body>
</html>
