<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Analysis - PhishGuard</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body.dark-theme {
      padding-top: 80px;
      padding-bottom: 80px;
    }
    
    /* Header Navigation Styles */
    .top-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      padding: 0 30px;
      height: 60px;
    }
    
    .top-header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 100%;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
    }
    
    .logo {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .logo i {
      font-size: 1.4rem;
    }
    
    .header-nav {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .header-nav-item {
      color: var(--text-primary);
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 4px;
      font-size: 0.9rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .header-nav-item:hover {
      background-color: rgba(61, 133, 198, 0.1);
      color: var(--primary-color);
    }
    
    .header-nav-item.active {
      color: var(--primary-color);
      background-color: rgba(61, 133, 198, 0.1);
    }
    
    /* Analysis Container */
    .analysis-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
      position: relative;
    }
    
    .analysis-header:after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100px;
      height: 3px;
      background-color: var(--primary-color);
      border-radius: 3px;
    }
    
    .analysis-header h1 {
      font-size: 2rem;
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 0;
      color: var(--text-primary);
    }
    
    .analysis-header i {
      color: var(--primary-color);
    }
    
    /* Card Styles */
    .analysis-card {
      background-color: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--border-color);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      overflow: hidden;
      margin-bottom: 30px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .analysis-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
    }
    
    .card-section {
      padding: 30px;
    }
    
    /* Input Section */
    .input-section {
      text-align: center;
    }
    
    .input-section h2 {
      font-size: 1.8rem;
      color: var(--text-primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .input-section p {
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto 25px;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    .url-input-container {
      position: relative;
      max-width: 750px;
      margin: 30px auto;
    }
    
    .url-input-field {
      width: 100%;
      background-color: rgba(0, 0, 0, 0.2);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 18px 150px 18px 60px;
      font-size: 1.1rem;
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .url-input-field:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(61, 133, 198, 0.2);
    }
    
    .url-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 1.2rem;
    }
    
    .analyze-btn {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      padding: 12px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .analyze-btn:hover {
      filter: brightness(110%);
      transform: translateY(-50%) scale(1.02);
    }
    
    .analyze-btn:active {
      filter: brightness(95%);
    }
    
    .error-message {
      color: var(--danger-color);
      background-color: rgba(244, 67, 54, 0.1);
      border-radius: 8px;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      max-width: 750px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .input-footer {
      margin-top: 15px;
      color: var(--text-tertiary);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    /* Loading Animation */
    .analysis-loading {
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .loading-animation {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      position: relative;
      width: 80px;
      height: 80px;
    }
    
    .loading-animation .circle {
      position: absolute;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: var(--primary-color);
      animation: spin 1.2s linear infinite;
    }
    
    .loading-animation .circle:nth-child(1) {
      animation-delay: 0s;
    }
    
    .loading-animation .circle:nth-child(2) {
      width: 48px;
      height: 48px;
      border-top-color: var(--accent-color);
      animation-duration: 1.6s;
      animation-direction: reverse;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-message {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 10px;
    }
    
    .loading-details {
      color: var(--text-secondary);
      max-width: 600px;
      margin-bottom: 30px;
    }
    
    .loading-progress {
      width: 100%;
      max-width: 400px;
      height: 8px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    
    .loading-progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      border-radius: 4px;
      animation: loading 2s ease-in-out infinite;
    }
    
    @keyframes loading {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }
    
    /* Results Section */
    .result-section {
      padding: 0;
    }
    
    .result-header-banner {
      background: linear-gradient(145deg, rgba(61, 133, 198, 0.1), rgba(0, 0, 0, 0.1));
      padding: 25px 30px;
      display: flex;
      align-items: center;
      gap: 20px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .result-icon-container {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      flex-shrink: 0;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }
    
    .result-icon-container.icon-safe {
      background: linear-gradient(145deg, #4caf50, #2e7d32);
      color: white;
    }
    
    .result-icon-container.icon-warning {
      background: linear-gradient(145deg, #ff9800, #f57c00);
      color: white;
    }
    
    .result-icon-container.icon-danger {
      background: linear-gradient(145deg, #f44336, #c62828);
      color: white;
    }
    
    .result-header-content {
      flex-grow: 1;
    }
    
    .result-header-content h2 {
      margin: 0 0 5px 0;
      font-size: 1.8rem;
    }
    
    .analyzed-url {
      color: var(--text-secondary);
      font-family: monospace;
      font-size: 1rem;
      padding: 5px 0;
      word-break: break-all;
    }
    
    .result-details {
      padding: 30px;
    }
    
    /* Score Visualization */
    .score-container {
      margin-bottom: 30px;
    }
    
    .score-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .score-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .score-value {
      font-size: 1.4rem;
      font-weight: 700;
    }
    
    .score-meter {
      height: 12px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      overflow: hidden;
      position: relative;
    }
    
    .score-fill {
      height: 100%;
      width: 0%;
      border-radius: 6px;
      transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .score-fill-safe {
      background: linear-gradient(90deg, #43a047, #66bb6a);
    }
    
    .score-fill-medium {
      background: linear-gradient(90deg, #fb8c00, #ffa726);
    }
    
    .score-fill-danger {
      background: linear-gradient(90deg, #e53935, #ef5350);
    }
    
    .score-markers {
      display: flex;
      justify-content: space-between;
      color: var(--text-tertiary);
      font-size: 0.8rem;
      padding-top: 8px;
    }
    
    .result-explanation {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 30px;
    }
    
    /* Result Sections */
    .result-sections {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    
    .result-summary {
      background-color: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      padding: 25px;
      border: 1px solid var(--border-color);
    }
    
    .result-summary-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      font-size: 1.3rem;
      color: var(--text-primary);
    }
    
    .result-summary-header i {
      color: var(--primary-color);
    }
    
    .result-summary-content {
      color: var(--text-secondary);
      line-height: 1.6;
    }
    
    .warning-message {
      background-color: rgba(244, 67, 54, 0.1);
      color: #f44336;
      padding: 12px 15px;
      border-radius: 8px;
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .warning-message::before {
      content: '\f071';
      font-family: 'Font Awesome 5 Free';
      font-weight: 900;
    }
    
    /* Result Footer */
    .result-footer {
      margin-top: 30px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    
    .btn-new-analysis, .btn-learn-more, .btn-view-details {
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      text-decoration: none;
    }
    
    .btn-new-analysis {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }
    
    .btn-new-analysis:hover {
      background-color: rgba(255, 255, 255, 0.15);
    }
    
    .btn-learn-more {
      background: linear-gradient(90deg, #4a6fa1, #5b8dbe);
      color: white;
      border: none;
      box-shadow: 0 4px 10px rgba(61, 133, 198, 0.2);
      font-weight: 600;
      letter-spacing: 0.2px;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .btn-learn-more::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.7s ease;
      z-index: -1;
    }
    
    .btn-learn-more:hover {
      background: linear-gradient(90deg, #5b8dbe, #4a6fa1);
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(61, 133, 198, 0.3);
    }
    
    .btn-learn-more:hover::before {
      left: 100%;
    }
    
    .btn-learn-more:active {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(61, 133, 198, 0.2);
    }
    
    .btn-view-details {
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      color: white;
      border: none;
    }
    
    .btn-view-details:hover {
      filter: brightness(110%);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    /* Educational Section */
    .education-container {
      background-color: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--border-color);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .education-header {
      background: linear-gradient(145deg, rgba(61, 133, 198, 0.1), rgba(0, 0, 0, 0.05));
      padding: 20px 30px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .education-header i {
      font-size: 1.4rem;
      color: var(--primary-color);
    }
    
    .education-header h2 {
      margin: 0;
      font-size: 1.4rem;
      color: var(--text-primary);
    }
    
    .education-content {
      padding: 30px;
    }
    
    .education-placeholder {
      text-align: center;
      color: var(--text-tertiary);
      padding: 20px 0;
    }
    
    .education-placeholder i {
      font-size: 2.5rem;
      margin-bottom: 15px;
      background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .education-placeholder h3 {
      margin-top: 0;
      color: var(--text-primary);
    }
    
    .education-placeholder p {
      max-width: 500px;
      margin: 10px auto;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .result-header-banner {
        flex-direction: column;
        text-align: center;
      }
      
      .result-icon-container {
        margin: 0 auto;
      }
      
      .score-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .result-footer {
        flex-direction: column;
      }
      
      .btn-new-analysis, .btn-learn-more, .btn-view-details {
        width: 100%;
        justify-content: center;
      }
      
      .analyze-btn {
        position: relative;
        right: auto;
        top: auto;
        transform: none;
        width: 100%;
        margin-top: 20px;
        justify-content: center;
      }
      
      .url-input-field {
        padding-right: 20px;
      }
    }

    /* Enhanced Transparency Report Styling */
    .transparent-report {
      font-family: var(--font-main);
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    .scan-summary {
      margin-bottom: 20px;
      border-radius: 10px;
      padding: 20px;
      background-color: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    
    .scan-summary h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.4rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .scan-summary h3::before {
      content: "\f201";
      font-family: "Font Awesome 5 Free";
      font-weight: 900;
      font-size: 18px;
      color: var(--primary-color);
    }
    
    .risk-score {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .risk-score-label {
      font-size: 16px;
      color: var(--text-secondary);
    }
    
    .risk-score span {
      font-size: 24px;
      font-weight: 700;
    }
    
    .risk-score span.high-risk {
      color: #f44336;
    }
    
    .risk-score span.medium-risk {
      color: #ff9800;
    }
    
    .risk-score span.low-risk {
      color: #4caf50;
    }
    
    .factors-section {
      margin-bottom: 25px;
    }
    
    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text-primary);
    }
    
    .section-title i {
      color: var(--primary-color);
    }
    
    .risk-factors-list, .safe-factors-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .factor-card {
      background-color: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      padding: 15px 20px;
      border-left: 4px solid transparent;
    }
    
    .factor-card.high {
      border-left-color: #f44336;
    }
    
    .factor-card.medium {
      border-left-color: #ff9800;
    }
    
    .factor-card.low {
      border-left-color: #ffc107;
    }
    
    .factor-card.safe {
      border-left-color: #4caf50;
    }
    
    .factor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .factor-name {
      font-weight: 600;
      font-size: 16px;
      color: var(--text-primary);
    }
    
    .factor-impact {
      font-size: 13px;
    }
    
    .impact-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
    }
    
    .impact-badge.high {
      background-color: rgba(244, 67, 54, 0.15);
      color: #f44336;
    }
    
    .impact-badge.medium {
      background-color: rgba(255, 152, 0, 0.15);
      color: #ff9800;
    }
    
    .impact-badge.low {
      background-color: rgba(255, 235, 59, 0.15);
      color: #ffd600;
    }
    
    .factor-explanation {
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    
    .factor-value {
      font-size: 13px;
      color: var(--text-tertiary);
    }
    
    .recommendations-section {
      margin-top: 25px;
      background-color: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid var(--border-color);
    }
    
    .recommendations-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .recommendations-title i {
      color: var(--primary-color);
    }
    
    .security-advice {
      background-color: rgba(76, 175, 80, 0.05);
      border-left: 4px solid #4caf50;
      padding: 15px 20px;
      border-radius: 8px;
    }
    
    .security-advice.high-risk {
      background-color: rgba(244, 67, 54, 0.05);
      border-left: 4px solid #f44336;
    }
    
    .security-advice.medium-risk {
      background-color: rgba(255, 152, 0, 0.05);
      border-left: 4px solid #ff9800;
    }
  </style>
</head>
<body class="dark-theme">
  <header class="top-header">
    <div class="top-header-content">
      <div class="logo-container">
        <a href="index.html" class="logo">
          <i class="fas fa-shield-alt"></i>
          <span>PhishGuard</span>
        </a>
      </div>
      <nav class="header-nav">
        <a href="dashboard.html" class="header-nav-item">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <a href="analyze.html" class="header-nav-item active">
          <i class="fas fa-search"></i> Analyze
        </a>
        <a href="settings.html" class="header-nav-item">
          <i class="fas fa-cog"></i> Settings
        </a>
      </nav>
    </div>
  </header>

  <div class="analysis-container">
    <div class="analysis-header">
      <h1><i class="fas fa-shield-check"></i> URL Analysis</h1>
      <a href="dashboard.html" class="btn-new-analysis">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
    
    <!-- Analysis Card -->
    <div class="analysis-card">
      <!-- Input Section -->
      <div class="card-section input-section" id="analysis-input">
        <h2><i class="fas fa-shield-alt"></i> Check Any URL for Threats</h2>
        <p>Enter a website address below to analyze it for potential phishing indicators and security risks.</p>
        
        <div class="url-input-container">
          <i class="fas fa-globe url-icon"></i>
          <input type="url" id="url-input" class="url-input-field" placeholder="Enter URL (e.g., https://example.com)" autofocus>
          <button id="analyze-button" class="analyze-btn">
            <i class="fas fa-search"></i> Analyze
          </button>
        </div>
        
        <div id="input-error" class="error-message" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span>Please enter a valid URL (e.g., https://example.com)</span>
        </div>
        <div class="input-footer">
          <i class="fas fa-info-circle"></i>
          <span>Include http:// or https:// for accurate analysis</span>
        </div>
      </div>

      <!-- Loading Section -->
      <div id="loading-container" class="analysis-loading" style="display: none;">
        <div class="loading-animation">
          <div class="circle"></div>
          <div class="circle"></div>
        </div>
        <div class="loading-message">Analyzing URL</div>
        <div class="loading-details">We're checking for phishing indicators, security certificates, domain reputation, and other risk factors...</div>
        <div class="loading-progress">
          <div class="loading-progress-bar"></div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results-container" class="result-section" style="display: none;">
        <div class="result-header-banner">
          <div id="result-icon-container" class="result-icon-container icon-safe">
            <i id="result-icon" class="fas fa-shield-check"></i>
          </div>
          <div class="result-header-content">
            <h2 id="result-title">Analysis Complete</h2>
            <div id="analyzed-url" class="analyzed-url">URL: https://example.com</div>
          </div>
        </div>
              
        <div class="result-details">
          <div class="score-container">
            <div class="score-header">
              <div class="score-title">Risk Score</div>
              <div id="risk-score-value" class="score-value">0/100</div>
            </div>
            <div class="score-meter">
              <div id="score-fill" class="score-fill score-fill-safe" style="width: 0%"></div>
            </div>
            <div class="score-markers">
              <span>Low Risk</span>
              <span>Medium Risk</span>
              <span>High Risk</span>
            </div>
          </div>
          
          <div id="risk-explanation" class="result-explanation">
            <!-- ML feature explainer content will be inserted here -->
          </div>
          
          <div class="result-summary">
            <div class="result-summary-header">
              <i class="fas fa-clipboard-list"></i>
              <h3>Analysis Summary</h3>
            </div>
            <div class="result-summary-content" id="analysis-summary">
              <!-- Summary content will be inserted here by JavaScript -->
            </div>
          </div>
          
          <div class="result-footer">
            <button id="new-analysis" class="btn-new-analysis">
              <i class="fas fa-redo-alt"></i> New Analysis
            </button>
            <a id="learn-more" href="education.html" class="btn-learn-more">
              <i class="fas fa-book"></i> Learn About Phishing
            </a>
            <a id="view-details" href="analysis-details.html" class="btn-view-details">
              <i class="fas fa-chart-bar"></i> View Detailed Report
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Educational Resources Section -->
    <div class="education-container">
      <div class="education-header">
        <i class="fas fa-graduation-cap"></i>
        <h2>Phishing Prevention</h2>
      </div>
      <div class="education-content">
        <div id="education-content" class="education-placeholder">
          <i class="fas fa-shield-alt"></i>
          <h3>URL Analysis & Protection</h3>
          <p>Complete a URL analysis to get personalized security insights and learn how to protect yourself from the latest phishing techniques.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add script tags -->
  <script src="js/ml-feature-explainer.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Check if user is logged in
      const token = localStorage.getItem('phishguardToken');
      if (!token) {
        window.location.href = 'login.html';
        return;
      }
      
      const urlInput = document.getElementById('url-input');
      const analyzeButton = document.getElementById('analyze-button');
      const inputError = document.getElementById('input-error');
      const loadingContainer = document.getElementById('loading-container');
      const resultsContainer = document.getElementById('results-container');
      const analysisInput = document.getElementById('analysis-input');
      const resultIcon = document.getElementById('result-icon');
      const resultIconContainer = document.getElementById('result-icon-container');
      const resultTitle = document.getElementById('result-title');
      const analyzedUrl = document.getElementById('analyzed-url');
      const scoreFill = document.getElementById('score-fill');
      const riskScoreValue = document.getElementById('risk-score-value');
      const riskExplanation = document.getElementById('risk-explanation');
      const analysisSummary = document.getElementById('analysis-summary');
      const newAnalysisButton = document.getElementById('new-analysis');
      const viewDetailsButton = document.getElementById('view-details');
      
      // URL validation function
      function isValidUrl(url) {
        try {
          new URL(url);
          return true;
        } catch (e) {
          return false;
        }
      }
      
      // Handle analysis button click
      analyzeButton.addEventListener('click', async () => {
        inputError.style.display = 'none';
        const url = urlInput.value.trim();
        
        if (!url) {
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = 'Please enter a URL to analyze';
          return;
        }
        
        if (!isValidUrl(url)) {
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = 'Please enter a valid URL (e.g., https://example.com)';
          return;
        }
        
        analysisInput.style.display = 'none';
        loadingContainer.style.display = 'flex';
        resultsContainer.style.display = 'none';
        
        try {
          const response = await fetch('http://localhost:3000/analyze-url', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-auth-token': token
            },
            body: JSON.stringify({ 
              url: url,
              useSafeBrowsing: true
            })
          });
          
          if (!response.ok) {
            throw new Error('Failed to analyze URL');
          }
          
          const result = await response.json();
          displayResults(url, result);
        } catch (error) {
          console.error('Analysis error:', error);
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = error.message || 'Failed to analyze URL. Please try again.';
          analysisInput.style.display = 'block';
          loadingContainer.style.display = 'none';
        }
      });
      
      // Display analysis results
      function displayResults(url, result) {
        analyzedUrl.textContent = `URL: ${url}`;
        
        let score;
        if (result.risk_score > 1) {
          score = Math.min(100, result.risk_score);
        } else {
          score = result.risk_score * 100;
        }
        
        const displayScore = Math.round(score * 10) / 10;
        riskScoreValue.textContent = `${displayScore}/100`;
        
        const isHighRisk = score > 60;
        const isMediumRisk = score > 30;
        const mlPrediction = result.ml_result?.prediction || 0;
        
        if (result.is_phishing || (isHighRisk && mlPrediction === 1)) {
          resultIcon.className = 'fas fa-exclamation-triangle';
          resultIconContainer.className = 'result-icon-container icon-danger';
          resultTitle.textContent = 'Phishing Detected!';
          resultTitle.style.color = '#f44336';
          scoreFill.className = 'score-fill score-fill-danger';
        } else if (isMediumRisk || mlPrediction === 1) {
          resultIcon.className = 'fas fa-exclamation-circle';
          resultIconContainer.className = 'result-icon-container icon-warning';
          resultTitle.textContent = 'Caution Advised';
          resultTitle.style.color = '#ff9800';
          scoreFill.className = 'score-fill score-fill-medium';
        } else {
          resultIcon.className = 'fas fa-shield-check';
          resultIconContainer.className = 'result-icon-container icon-safe';
          resultTitle.textContent = 'Likely Safe';
          resultTitle.style.color = '#4caf50';
          scoreFill.className = 'score-fill score-fill-safe';
        }
        
        setTimeout(() => {
          scoreFill.style.width = `${score}%`;
        }, 300);
        
        try {
          const featureExplainer = new MLFeatureExplainer();
          
          // Extract features from all possible locations
          let features = {};
          
          if (result.features && typeof result.features === 'object') {
            features = result.features;
          }
          
          if (result.ml_result && result.ml_result.features) {
            features = {...features, ...result.ml_result.features};
          }
          
          // Extract specific known features that might be at the top level
          const topLevelFeatures = [
            'domain_in_ip', 'tls_ssl_certificate', 'length_url', 'qty_dot_url', 
            'qty_hyphen_url', 'qty_at_url', 'domain_google_index', 
            'url_google_index', 'qty_redirects', 'time_domain_activation', 
            'url_shortened', 'qty_ip_resolved', 'domain_spf', 'asn_ip'
          ];
          
          topLevelFeatures.forEach(feature => {
            if (result[feature] !== undefined) {
              features[feature] = result[feature];
            }
          });
          
          // Special handling for IP address
          if (features.domain_in_ip === undefined && /\d+\.\d+\.\d+\.\d+/.test(url)) {
            features.domain_in_ip = 1;
          }
          
          // Handle SSL certificate
          if (features.tls_ssl_certificate === undefined) {
            features.tls_ssl_certificate = url.startsWith('https:') ? 1 : 0;
          }
          
          // Make sure URL length is included
          if (features.length_url === undefined) {
            features.length_url = url.length;
          }
          
          // Store complete analysis data for the details page
          sessionStorage.setItem('analysisData', JSON.stringify({
            url: url,
            features: features,
            result: {
              risk_score: displayScore,
              is_phishing: result.is_phishing
            }
          }));
          
          // Use the summary HTML generator
          const summaryHTML = featureExplainer.generateSummaryHTML(features, url, {
            risk_score: displayScore,
            is_phishing: result.is_phishing
          });
          
          riskExplanation.innerHTML = summaryHTML;
          riskExplanation.className = 'result-explanation transparent-report';
        } catch (error) {
          console.error('Error generating explanation:', error);
          riskExplanation.textContent = result.risk_explanation || 'No detailed explanation available.';
        }
        
        // Generate summary
        let summaryHTML = '';
        
        if (result.is_phishing || (isHighRisk && mlPrediction === 1)) {
          summaryHTML = `
            <p><strong>High Risk Detected:</strong> Our analysis indicates this URL has multiple 
            characteristics commonly associated with phishing websites. The risk score 
            of ${displayScore}/100 suggests this may be an attempt to steal sensitive information.</p>
            
            ${result.safe_browsing_result?.threats ? '<p class="warning-message">Google Safe Browsing has flagged this website as dangerous.</p>' : ''}
            
            <p>View the detailed report for a comprehensive breakdown of all detected risk factors.</p>
          `;
        } else if (isMediumRisk) {
          summaryHTML = `
            <p><strong>Moderate Risk Detected:</strong> This URL shows some suspicious characteristics
            but may not be a confirmed phishing site. The risk score of ${displayScore}/100 indicates
            caution is advised when interacting with this website.</p>
            
            <p>Check the detailed report for a complete analysis of the potential concerns.</p>
          `;
        } else {
          summaryHTML = `
            <p><strong>Low Risk Detected:</strong> Our analysis indicates this URL appears to be legitimate
            with a low risk score of ${displayScore}/100. No major phishing indicators were detected.</p>
            
            <p>For additional confidence, view the detailed report to see all security checks performed.</p>
          `;
        }
        
        analysisSummary.innerHTML = summaryHTML;
        loadEducationalContent(result, displayScore);
        
        loadingContainer.style.display = 'none';
        resultsContainer.style.display = 'block';
      }
      
      function loadEducationalContent(analysisResult, displayScore) {
        const educationContent = document.getElementById('education-content');
        const features = analysisResult.ml_result?.features || {};
        
        // Determine risk level
        const riskLevel = analysisResult.is_phishing ? 'high' : 
                         (displayScore > 60) ? 'high' :
                         (displayScore > 30) ? 'medium' : 'low';
        
        // Build a list of security issues based on features
        const securityIssues = [];
        
        // Check for common issues
        if (features.domain_in_ip === 1 || features.domain_in_ip === true || features.domain_in_ip === 1.0) {
          securityIssues.push("IP address used instead of domain name");
        }
        
        if (features.tls_ssl_certificate === 0 || features.tls_ssl_certificate === false || features.tls_ssl_certificate === 0.0) {
          securityIssues.push("Missing SSL/TLS security certificate");
        }
        
        if (features.url_shortened === 1 || features.url_shortened === true || features.url_shortened === 1.0) {
          securityIssues.push("URL shortening service used");
        }
        
        if (features.qty_redirects > 1) {
          securityIssues.push(`${features.qty_redirects} redirects detected`);
        }
        
        if (features.time_domain_activation < 30 && features.time_domain_activation !== 0) {
          securityIssues.push(`Very new domain (only ${features.time_domain_activation} days old)`);
        }
        
        // Generate educational content
        let educationalHTML = '';
        
        if (riskLevel === 'high') {
          educationalHTML = `
            <h3>Understanding High-Risk Phishing Sites</h3>
            <p>This URL shows multiple indicators commonly associated with phishing attacks:</p>
            ${securityIssues.length > 0 ? 
              `<ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
                ${securityIssues.map(issue => `<li>${issue}</li>`).join('')}
              </ul>` : ''}
            
            <p>Phishing sites often:</p>
            <ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
              <li>Mimic legitimate websites to steal your credentials</li>
              <li>Create a false sense of urgency to prompt immediate action</li>
              <li>Use suspicious domain names that look similar to legitimate sites</li>
              <li>Request sensitive personal information</li>
            </ul>
            <p><strong>Always verify a website's legitimacy before entering personal information.</strong></p>
          `;
        } else if (riskLevel === 'medium') {
          educationalHTML = `
            <h3>Understanding Medium-Risk Websites</h3>
            <p>This URL has some suspicious characteristics that warrant caution:</p>
            ${securityIssues.length > 0 ? 
              `<ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
                ${securityIssues.map(issue => `<li>${issue}</li>`).join('')}
              </ul>` : ''}
            
            <p>When dealing with medium-risk sites:</p>
            <ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
              <li>Verify the website's identity through other channels</li>
              <li>Check for HTTPS security and a valid certificate</li>
              <li>Be cautious about sharing personal information</li>
              <li>Look for contact information and legitimate privacy policies</li>
            </ul>
            <p><strong>Use caution and your best judgment when interacting with this site.</strong></p>
          `;
        } else {
          educationalHTML = `
            <h3>Safe Browsing Practices</h3>
            <p>This URL appears to be safe, but it's always good to follow these secure browsing habits:</p>
            <ul style="padding-left: 20px; margin: 15px 0; color: var(--text-secondary);">
              <li>Keep your browser and security software updated</li>
              <li>Use strong, unique passwords for different websites</li>
              <li>Enable two-factor authentication when available</li>
              <li>Be careful when clicking on links in emails or messages</li>
              <li>Check website URLs before entering personal information</li>
            </ul>
            <p><strong>Even on safe websites, always be mindful of the information you share online.</strong></p>
          `;
        }
        
        educationContent.innerHTML = educationalHTML;
      }
      
      // Handle new analysis button click
      newAnalysisButton.addEventListener('click', () => {
        urlInput.value = '';
        resultsContainer.style.display = 'none';
        loadingContainer.style.display = 'none';
        analysisInput.style.display = 'block';
        inputError.style.display = 'none';
        urlInput.focus();
      });
      
      // Handle key press in URL input
      urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          analyzeButton.click();
        }
      });
    });
  </script>
</body>
</html>
`
