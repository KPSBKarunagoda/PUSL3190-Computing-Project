<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Analysis - PhishGuard</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body.dark-theme {
      padding-top: 80px;
      padding-bottom: 80px;
    }
    
    /* Header Navigation Styles */
    .top-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      padding: 0 30px;
      height: 60px;
    }
    
    .top-header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 100%;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
    }
    
    .logo {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .logo i {
      font-size: 1.4rem;
    }
    
    .header-nav {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .header-nav-item {
      color: var(--text-primary);
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 4px;
      font-size: 0.9rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .header-nav-item:hover {
      background-color: rgba(61, 133, 198, 0.1);
      color: var(--primary-color);
    }
    
    .header-nav-item.active {
      color: var(--primary-color);
      background-color: rgba(61, 133, 198, 0.1);
    }
    
    /* Analysis Container */
    .analysis-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
      position: relative;
    }
    
    .analysis-header:after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100px;
      height: 3px;
      background-color: var(--primary-color);
      border-radius: 3px;
    }
    
    .analysis-header h1 {
      font-size: 2rem;
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 0;
      color: var(--text-primary);
    }
    
    .analysis-header i {
      color: var(--primary-color);
    }
    
    /* Card Styles */
    .analysis-card {
      background-color: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--border-color);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      overflow: hidden;
      margin-bottom: 30px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .analysis-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
    }
    
    .card-section {
      padding: 30px;
    }
    
    /* Input Section */
    .input-section {
      text-align: center;
    }
    
    .input-section h2 {
      font-size: 1.8rem;
      color: var(--text-primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .input-section p {
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto 25px;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    .url-input-container {
      position: relative;
      max-width: 750px;
      margin: 30px auto;
    }
    
    .url-input-field {
      width: 100%;
      background-color: rgba(0, 0, 0, 0.2);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 18px 150px 18px 60px;
      font-size: 1.1rem;
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .url-input-field:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(61, 133, 198, 0.2);
    }
    
    .url-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 1.2rem;
    }
    
    .analyze-btn {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      padding: 12px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .analyze-btn:hover {
      filter: brightness(110%);
      transform: translateY(-50%) scale(1.02);
    }
    
    .analyze-btn:active {
      filter: brightness(95%);
    }
    
    .error-message {
      color: var(--danger-color);
      background-color: rgba(244, 67, 54, 0.1);
      border-radius: 8px;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      max-width: 750px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .input-footer {
      margin-top: 15px;
      color: var(--text-tertiary);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    /* Loading Animation */
    .analysis-loading {
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .loading-animation {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      position: relative;
      width: 80px;
      height: 80px;
    }
    
    .loading-animation .circle {
      position: absolute;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: var(--primary-color);
      animation: spin 1.2s linear infinite;
    }
    
    .loading-animation .circle:nth-child(1) {
      animation-delay: 0s;
    }
    
    .loading-animation .circle:nth-child(2) {
      width: 48px;
      height: 48px;
      border-top-color: var(--accent-color);
      animation-duration: 1.6s;
      animation-direction: reverse;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-message {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 10px;
    }
    
    .loading-details {
      color: var(--text-secondary);
      max-width: 600px;
      margin-bottom: 30px;
    }
    
    .loading-progress {
      width: 100%;
      max-width: 400px;
      height: 8px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    
    .loading-progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      border-radius: 4px;
      animation: loading 2s ease-in-out infinite;
    }
    
    @keyframes loading {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }
    
    /* Enhanced Results Section - Simplified for Summary View */
    .result-section {
      padding: 0;
    }
    
    .result-header-banner {
      background: linear-gradient(145deg, rgba(61, 133, 198, 0.1), rgba(0, 0, 0, 0.1));
      padding: 25px 30px;
      display: flex;
      align-items: center;
      gap: 20px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .result-icon-container {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      flex-shrink: 0;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }
    
    /* Updated Score Display for Simplified View */
    .score-summary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .score-ring {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(var(--primary-color) 0%, transparent 0%);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 1s ease;
    }
    
    .score-ring::before {
      content: "";
      position: absolute;
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background-color: var(--card-bg);
    }
    
    .score-value-container {
      position: relative;
      z-index: 2;
      text-align: center;
    }
    
    .score-value-large {
      font-size: 2.2rem;
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .score-label {
      font-size: 0.8rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .score-interpretation {
      flex-grow: 1;
      padding-left: 20px;
    }
    
    .score-interpretation h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .score-interpretation p {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 10px;
    }
    
    /* Key Findings Section */
    .key-findings {
      background-color: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .key-findings h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.3rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .findings-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .findings-list li {
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: flex-start;
      gap: 10px;
      color: var(--text-secondary);
    }
    
    .findings-list li:last-child {
      border-bottom: none;
    }
    
    .findings-list i {
      margin-top: 3px;
    }
    
    .item-high i {
      color: #f44336;
    }
    
    .item-medium i {
      color: #ff9800;
    }
    
    .item-low i {
      color: #4caf50;
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }
    
    .btn-view-details {
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .btn-view-details:hover {
      filter: brightness(110%);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    .btn-new-analysis {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .btn-new-analysis:hover {
      background-color: rgba(255, 255, 255, 0.15);
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .score-summary {
        flex-direction: column;
        text-align: center;
      }
      
      .score-interpretation {
        padding-left: 0;
        padding-top: 20px;
      }
      
      .score-interpretation h3 {
        justify-content: center;
      }
      
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body class="dark-theme">
  <header class="top-header">
    <div class="top-header-content">
      <div class="logo-container">
        <a href="index.html" class="logo">
          <i class="fas fa-shield-alt"></i>
          <span>PhishGuard</span>
        </a>
      </div>
      <nav class="header-nav">
        <a href="dashboard.html" class="header-nav-item">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <a href="analyze.html" class="header-nav-item active">
          <i class="fas fa-search"></i> Analyze
        </a>
        <a href="settings.html" class="header-nav-item">
          <i class="fas fa-cog"></i> Settings
        </a>
      </nav>
    </div>
  </header>

  <div class="analysis-container">
    <div class="analysis-header">
      <h1><i class="fas fa-shield-check"></i> URL Analysis</h1>
      <a href="dashboard.html" class="btn-new-analysis">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
    
    <!-- Analysis Card -->
    <div class="analysis-card">
      <!-- Input Section -->
      <div class="card-section input-section" id="analysis-input">
        <h2><i class="fas fa-shield-alt"></i> Check Any URL for Threats</h2>
        <p>Enter a website address below to analyze it for potential phishing indicators and security risks.</p>
        
        <div class="url-input-container">
          <i class="fas fa-globe url-icon"></i>
          <input type="url" id="url-input" class="url-input-field" placeholder="Enter URL (e.g., https://example.com)" autofocus>
          <button id="analyze-button" class="analyze-btn">
            <i class="fas fa-search"></i> Analyze
          </button>
        </div>
        
        <div id="input-error" class="error-message" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span>Please enter a valid URL (e.g., https://example.com)</span>
        </div>
        <div class="input-footer">
          <i class="fas fa-info-circle"></i>
          <span>Include http:// or https:// for accurate analysis</span>
        </div>
      </div>

      <!-- Loading Section -->
      <div id="loading-container" class="analysis-loading" style="display: none;">
        <div class="loading-animation">
          <div class="circle"></div>
          <div class="circle"></div>
        </div>
        <div class="loading-message">Analyzing URL</div>
        <div class="loading-details">We're checking for phishing indicators, security certificates, domain reputation, and other risk factors...</div>
        <div class="loading-progress">
          <div class="loading-progress-bar"></div>
        </div>
      </div>

      <!-- Results Section - Simplified -->
      <div id="results-container" class="result-section" style="display: none;">
        <div class="result-header-banner">
          <div id="result-icon-container" class="result-icon-container icon-safe">
            <i id="result-icon" class="fas fa-shield-check"></i>
          </div>
          <div class="result-header-content">
            <h2 id="result-title">Analysis Results</h2>
            <div id="analyzed-url" class="analyzed-url">URL: https://example.com</div>
          </div>
        </div>
              
        <div class="result-details">
          <!-- Simplified Score Display -->
          <div class="score-summary">
            <div class="score-ring" id="score-ring">
              <div class="score-value-container">
                <div id="risk-score-value" class="score-value-large">0</div>
                <div class="score-label">Risk Score</div>
              </div>
            </div>
            
            <div class="score-interpretation">
              <h3 id="result-interpretation">Analyzing Results...</h3>
              <p id="result-description">We're evaluating the security characteristics of this URL.</p>
              <p id="recommendation-text">View the detailed report for more information.</p>
            </div>
          </div>
          
          <!-- Key Findings Section -->
          <div class="key-findings">
            <h3><i class="fas fa-exclamation-circle"></i> Key Findings</h3>
            <ul id="findings-list" class="findings-list">
              <!-- Findings will be populated by JavaScript -->
            </ul>
          </div>
          
          <!-- Action Buttons -->
          <div class="action-buttons">
            <button id="new-analysis" class="btn-new-analysis">
              <i class="fas fa-redo-alt"></i> New Analysis
            </button>
            <a id="view-details" href="analysis-details.html" class="btn-view-details">
              <i class="fas fa-chart-bar"></i> View Detailed Analysis
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Educational Resources Section - Simplified -->
    <div class="education-container">
      <div class="education-header">
        <i class="fas fa-graduation-cap"></i>
        <h2>Phishing Prevention Tips</h2>
      </div>
      <div class="education-content">
        <div id="education-content" class="education-placeholder">
          <i class="fas fa-shield-alt"></i>
          <h3>Stay Protected Online</h3>
          <p>Always verify website URLs before entering sensitive information. Look for HTTPS, check domain names carefully, and be cautious with unfamiliar sites.</p>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Check if user is logged in
      const token = localStorage.getItem('phishguardToken');
      if (!token) {
        window.location.href = 'login.html';
        return;
      }
      
      const urlInput = document.getElementById('url-input');
      const analyzeButton = document.getElementById('analyze-button');
      const inputError = document.getElementById('input-error');
      const loadingContainer = document.getElementById('loading-container');
      const resultsContainer = document.getElementById('results-container');
      const analysisInput = document.getElementById('analysis-input');
      const resultIcon = document.getElementById('result-icon');
      const resultIconContainer = document.getElementById('result-icon-container');
      const resultTitle = document.getElementById('result-title');
      const analyzedUrl = document.getElementById('analyzed-url');
      const scoreRing = document.getElementById('score-ring');
      const riskScoreValue = document.getElementById('risk-score-value');
      const resultInterpretation = document.getElementById('result-interpretation');
      const resultDescription = document.getElementById('result-description');
      const recommendationText = document.getElementById('recommendation-text');
      const findingsList = document.getElementById('findings-list');
      const newAnalysisButton = document.getElementById('new-analysis');
      const viewDetailsButton = document.getElementById('view-details');
      
      // URL validation function
      function isValidUrl(url) {
        try {
          new URL(url);
          return true;
        } catch (e) {
          return false;
        }
      }
      
      // Handle analysis button click
      analyzeButton.addEventListener('click', async () => {
        inputError.style.display = 'none';
        const url = urlInput.value.trim();
        
        if (!url) {
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = 'Please enter a URL to analyze';
          return;
        }
        
        if (!isValidUrl(url)) {
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = 'Please enter a valid URL (e.g., https://example.com)';
          return;
        }
        
        analysisInput.style.display = 'none';
        loadingContainer.style.display = 'flex';
        resultsContainer.style.display = 'none';
        
        try {
          const response = await fetch('http://localhost:3000/analyze-url', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-auth-token': token
            },
            body: JSON.stringify({ 
              url: url,
              useSafeBrowsing: true
            })
          });
          
          if (!response.ok) {
            throw new Error('Failed to analyze URL');
          }
          
          const result = await response.json();
          displayResults(url, result);
        } catch (error) {
          console.error('Analysis error:', error);
          inputError.style.display = 'flex';
          inputError.querySelector('span').textContent = error.message || 'Failed to analyze URL. Please try again.';
          analysisInput.style.display = 'block';
          loadingContainer.style.display = 'none';
        }
      });
      
      // Display simplified analysis results
      function displayResults(url, result) {
        analyzedUrl.textContent = `URL: ${url}`;
        
        let score;
        if (result.risk_score > 1) {
          score = Math.min(100, result.risk_score);
        } else {
          score = result.risk_score * 100;
        }
        
        const displayScore = Math.round(score);
        riskScoreValue.textContent = displayScore;
        
        const isHighRisk = score > 60;
        const isMediumRisk = score > 30;
        const mlPrediction = result.ml_result?.prediction || 0;
        
        // Update result icon and title
        if (result.is_phishing || (isHighRisk && mlPrediction === 1)) {
          resultIcon.className = 'fas fa-exclamation-triangle';
          resultIconContainer.className = 'result-icon-container icon-danger';
          resultTitle.textContent = 'Phishing Detected!';
          resultTitle.style.color = '#f44336';
          resultInterpretation.textContent = 'High Risk Detected';
          resultInterpretation.style.color = '#f44336';
          resultDescription.textContent = 'This URL shows multiple characteristics associated with phishing websites.';
          recommendationText.textContent = 'We strongly recommend avoiding this website.';
          animateScoreRing(score, '#f44336');
        } else if (isMediumRisk || mlPrediction === 1) {
          resultIcon.className = 'fas fa-exclamation-circle';
          resultIconContainer.className = 'result-icon-container icon-warning';
          resultTitle.textContent = 'Caution Advised';
          resultTitle.style.color = '#ff9800';
          resultInterpretation.textContent = 'Suspicious URL';
          resultInterpretation.style.color = '#ff9800';
          resultDescription.textContent = 'This URL has some suspicious characteristics that warrant caution.';
          recommendationText.textContent = 'Exercise caution if you choose to visit this website.';
          animateScoreRing(score, '#ff9800');
        } else {
          resultIcon.className = 'fas fa-shield-check';
          resultIconContainer.className = 'result-icon-container icon-safe';
          resultTitle.textContent = 'Likely Safe';
          resultTitle.style.color = '#4caf50';
          resultInterpretation.textContent = 'Low Risk';
          resultInterpretation.style.color = '#4caf50';
          resultDescription.textContent = 'No major phishing indicators were detected for this URL.';
          recommendationText.textContent = 'This URL appears to be legitimate based on our analysis.';
          animateScoreRing(score, '#4caf50');
        }
        
        // Generate key findings - extract features from different possible locations
        let features = {};
        
        if (result.features && typeof result.features === 'object') {
          features = result.features;
        }
        
        if (result.ml_result && result.ml_result.features) {
          features = {...features, ...result.ml_result.features};
        }
        
        generateKeyFindings(findingsList, features, url);
        
        // Store complete analysis data for the details page
        sessionStorage.setItem('analysisData', JSON.stringify({
          url: url,
          features: features,
          result: {
            risk_score: displayScore,
            is_phishing: result.is_phishing
          }
        }));
        
        loadingContainer.style.display = 'none';
        resultsContainer.style.display = 'block';
      }
      
      // Generate key findings list
      function generateKeyFindings(container, features, url) {
        container.innerHTML = '';
        const findings = [];
        
        // Check for common issues and add them to findings
        if (features.domain_in_ip === 1 || /\d+\.\d+\.\d+\.\d+/.test(url)) {
          findings.push({
            text: 'IP address used instead of domain name',
            severity: 'high'
          });
        }
        
        if (features.tls_ssl_certificate === 0 || url.startsWith('http:')) {
          findings.push({
            text: 'Missing SSL/TLS security certificate',
            severity: 'high'
          });
        }
        
        if (features.url_shortened === 1) {
          findings.push({
            text: 'URL shortening service used',
            severity: 'medium'
          });
        }
        
        if (features.time_domain_activation < 30 && features.time_domain_activation > 0) {
          findings.push({
            text: `Very new domain (only ${features.time_domain_activation} days old)`,
            severity: 'high'
          });
        }
        
        if (features.qty_redirects > 1) {
          findings.push({
            text: `Multiple redirects detected (${features.qty_redirects})`,
            severity: 'medium'
          });
        }
        
        if (features.length_url > 75) {
          findings.push({
            text: 'Unusually long URL',
            severity: 'medium'
          });
        }
        
        // If no specific findings were detected
        if (findings.length === 0) {
          container.innerHTML = `
            <li class="item-low">
              <i class="fas fa-check-circle"></i>
              <span>No significant risk factors detected</span>
            </li>
          `;
          return;
        }
        
        // Add findings to the list (limit to top 5)
        findings.slice(0, 5).forEach(finding => {
          const iconClass = finding.severity === 'high' ? 'fas fa-exclamation-triangle' : 
                          finding.severity === 'medium' ? 'fas fa-exclamation-circle' : 
                          'fas fa-info-circle';
          
          container.innerHTML += `
            <li class="item-${finding.severity}">
              <i class="${iconClass}"></i>
              <span>${finding.text}</span>
            </li>
          `;
        });
        
        // If there are more findings than we're showing
        if (findings.length > 5) {
          container.innerHTML += `
            <li>
              <i class="fas fa-ellipsis-h"></i>
              <span>${findings.length - 5} more risk factors - see detailed report</span>
            </li>
          `;
        }
      }
      
      // Animate score ring based on risk level
      function animateScoreRing(score, color) {
        const percent = Math.min(100, Math.max(0, score));
        
        // Update the conic gradient based on percentage
        setTimeout(() => {
          scoreRing.style.background = `conic-gradient(
            ${color} 0% ${percent}%, 
            rgba(255, 255, 255, 0.1) ${percent}% 100%
          )`;
        }, 300);
      }
      
      // Handle new analysis button click
      newAnalysisButton.addEventListener('click', () => {
        urlInput.value = '';
        resultsContainer.style.display = 'none';
        loadingContainer.style.display = 'none';
        analysisInput.style.display = 'block';
        inputError.style.display = 'none';
        urlInput.focus();
      });
      
      // Handle key press in URL input
      urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          analyzeButton.click();
        }
      });
    });
  </script>
</body>
</html>
