<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PhishGuard Admin | System Settings</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="description" content="PhishGuard Admin System Settings">
  <style>
    /* Settings page specific styles */
    .status-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .system-info-card {
      background-color: var(--dark-lighter);
      border-radius: var(--radius);
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid var(--border);
    }

    .system-info-card h3 {
      margin-top: 0;
      font-size: 1.1rem;
      color: var(--text-primary);
      margin-bottom: 15px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .system-info-card h3 i {
      color: var(--primary);
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .info-value {
      font-weight: 500;
    }

    .data-export-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .export-option {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-color: rgba(0, 0, 0, 0.1);
      padding: 15px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .export-option h4 {
      margin: 0;
      color: var(--primary);
      font-size: 1rem;
    }

    .export-option p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .export-option .action-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }

    .last-export {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Toggle switch styles for theme and notification preferences */
    .preference-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .preference-item:last-child {
      border-bottom: none;
    }

    .preference-info {
      flex: 1;
    }

    .preference-info h4 {
      margin: 0 0 5px 0;
      font-size: 1rem;
    }

    .preference-info p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .toggle-switch {
      display: inline-block;
      position: relative;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      border-radius: 24px;
      transition: .4s;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: .4s;
    }

    input:checked + .toggle-slider {
      background-color: var(--primary);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    .theme-options {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .theme-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }

    .theme-option.active {
      border-color: var(--primary);
      transform: scale(1.1);
    }

    .theme-option.dark {
      background-color: #121212;
      border: 2px solid #333;
    }

    .theme-option.blue {
      background-color: #0d2a42;
      border: 2px solid #184c7a;
    }

    .theme-option.purple {
      background-color: #2d1b52;
      border: 2px solid #4a2b8a;
    }

    .dashboard-summary {
      margin-top: 20px;
    }

    .dashboard-summary h4 {
      margin: 0 0 10px 0;
      font-size: 1rem;
    }

    .summary-stats {
      display: flex;
      gap: 15px;
    }

    .stat-badge {
      background-color: rgba(0, 0, 0, 0.2);
      padding: 8px 12px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-badge i {
      color: var(--primary);
    }

    .stat-badge.users i {
      color: #3D85C6; /* Blue */
    }

    .stat-badge.whitelist i {
      color: #4CAF50; /* Green */
    }

    .stat-badge.blacklist i {
      color: #F72585; /* Red */
    }

    .stat-badge.scans i {
      color: #FFC107; /* Yellow */
    }

    .clipboard-button {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      padding: 0;
      font-size: 1rem;
    }

    .clipboard-button:hover {
      color: var(--primary-light);
    }

    #systemInfo .info-value {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #systemInfo .copy-value {
      font-family: monospace;
      background-color: rgba(0,0,0,0.2);
      padding: 2px 6px;
      border-radius: 4px;
      max-width: 250px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Add responsive styling */
    @media (max-width: 768px) {
      .status-row {
        flex-direction: column;
      }
      
      .system-info-card {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <h3><i class="fas fa-shield-alt"></i> PhishGuard</h3>
        <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle Sidebar">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      
      <ul class="sidebar-menu">
        <li>
          <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        </li>
        <li>
          <a href="users.html"><i class="fas fa-users"></i> Users</a>
        </li>
        <li>
          <a href="whitelist.html"><i class="fas fa-check-circle"></i> Whitelist</a>
        </li>
        <li>
          <a href="blacklist.html"><i class="fas fa-ban"></i> Blacklist</a>
        </li>
        <li>
          <a href="reports.html"><i class="fas fa-flag"></i> Reports</a>
        </li>
        <li>
          <a href="votes.html"><i class="fas fa-vote-yea"></i> Votes</a>
        </li>
        <li>
          <a href="contact.html"><i class="fas fa-envelope"></i> Contact</a>
        </li>
        <li class="active">
          <a href="settings.html"><i class="fas fa-cogs"></i> Settings</a>
        </li>
      </ul>
      
      <div class="sidebar-footer">
        <button id="logout-btn" class="btn btn-primary">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </nav>
    
    <!-- Main Content -->
    <main id="content" class="content">
      <header class="content-header">
        <h1>System Settings</h1>
        <div class="user-info">
          <span id="current-user">Admin</span>
          <div class="avatar">
            <i class="fas fa-user-shield"></i>
          </div>
        </div>
      </header>
      
      <div id="system-alert" class="alert" role="alert"></div>
      
      <!-- System Information Section -->
      <section class="card">
        <div class="card-header">
          <h2><i class="fas fa-info-circle"></i> System Information</h2>
        </div>
        
        <div class="card-body">
          <div class="status-row">
            <!-- System Information -->
            <div class="system-info-card" style="flex: 1;">
              <h3><i class="fas fa-server"></i> System Status</h3>
              <div id="systemInfo">
                <div class="info-item">
                  <span class="info-label">Server Time</span>
                  <span class="info-value" id="serverTime"></span>
                </div>
                <div class="info-item">
                  <span class="info-label">Server Uptime</span>
                  <span class="info-value" id="serverUptime"></span>
                </div>
                <div class="info-item">
                  <span class="info-label">API Status</span>
                  <span class="info-value"><span id="apiStatus" class="badge badge-success">Online</span></span>
                </div>
                <div class="info-item">
                  <span class="info-label">Admin Session ID</span>
                  <span class="info-value">
                    <span id="sessionID" class="copy-value">session-xxxxxxxx</span>
                    <button class="clipboard-button" data-clipboard="session-xxxxxxxx" title="Copy to clipboard">
                      <i class="fas fa-copy"></i>
                    </button>
                  </span>
                </div>
              </div>

              <div class="dashboard-summary">
                <h4>System Overview</h4>
                <div class="summary-stats">
                  <div class="stat-badge users">
                    <i class="fas fa-users"></i>
                    <span id="users-count-summary">0</span> Users
                  </div>
                  <div class="stat-badge whitelist">
                    <i class="fas fa-check-circle"></i>
                    <span id="whitelist-count-summary">0</span> Whitelisted
                  </div>
                  <div class="stat-badge blacklist">
                    <i class="fas fa-ban"></i>
                    <span id="blacklist-count-summary">0</span> Blacklisted
                  </div>
                  <div class="stat-badge scans">
                    <i class="fas fa-search"></i>
                    <span id="scans-count-summary">0</span> Scans
                  </div>
                </div>
              </div>
            </div>

            <!-- Version Information -->
            <div class="system-info-card" style="flex: 1;">
              <h3><i class="fas fa-code-branch"></i> Software Information</h3>
              <div id="versionInfo">
                <div class="info-item">
                  <span class="info-label">PhishGuard Version</span>
                  <span class="info-value">1.0.0</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Admin Dashboard</span>
                  <span class="info-value">v1.0.0</span>
                </div>
                <div class="info-item">
                  <span class="info-label">ML Model Version</span>
                  <span class="info-value">v5 (2023-06-15)</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Last Updated</span>
                  <span class="info-value" id="lastUpdated"></span>
                </div>
                <div class="info-item">
                  <span class="info-label">Database Schema</span>
                  <span class="info-value">v1.2</span>
                </div>
                <div class="info-item">
                  <span class="info-label">External API Status</span>
                  <span class="info-value" id="externalApiStatus">
                    <span class="badge badge-success">Operational</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Data Export Section (Reusing already-implemented export functionality) -->
      <section class="card">
        <div class="card-header">
          <h2><i class="fas fa-file-export"></i> Data Management</h2>
        </div>
        
        <div class="card-body">
          <div class="data-export-options">
            <div class="export-option">
              <h4><i class="fas fa-ban"></i> Blacklist Data</h4>
              <p>Export your current blacklisted domains to a CSV file for backup or analysis purposes.</p>
              <div class="action-row">
                <span class="last-export" id="blacklist-last-export">Last export: Never</span>
                <button id="export-blacklist" class="btn btn-primary">
                  <i class="fas fa-download"></i> Export Blacklist
                </button>
              </div>
            </div>
            
            <div class="export-option">
              <h4><i class="fas fa-check-circle"></i> Whitelist Data</h4>
              <p>Export your trusted domain whitelist to a CSV file for backup or sharing.</p>
              <div class="action-row">
                <span class="last-export" id="whitelist-last-export">Last export: Never</span>
                <button id="export-whitelist" class="btn btn-primary">
                  <i class="fas fa-download"></i> Export Whitelist
                </button>
              </div>
            </div>
            
            <div class="export-option">
              <h4><i class="fas fa-chart-line"></i> Analytics Data</h4>
              <p>Export system analytics and usage statistics for reporting purposes.</p>
              <div class="action-row">
                <span class="last-export" id="analytics-last-export">Last export: Never</span>
                <button id="export-analytics" class="btn btn-primary">
                  <i class="fas fa-download"></i> Export Analytics
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Admin Preferences Section -->
      <section class="card">
        <div class="card-header">
          <h2><i class="fas fa-user-cog"></i> Admin Preferences</h2>
        </div>
        
        <div class="card-body">
          <div class="preferences-list">
            <div class="preference-item">
              <div class="preference-info">
                <h4>Dashboard Auto-refresh</h4>
                <p>Automatically refresh dashboard statistics every 5 minutes</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="auto-refresh-toggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            
            <div class="preference-item">
              <div class="preference-info">
                <h4>Email Notifications</h4>
                <p>Receive email alerts for critical system events</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="email-notifications-toggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
            
            <div class="preference-item">
              <div class="preference-info">
                <h4>Interface Theme</h4>
                <p>Change the admin dashboard appearance</p>
                <div class="theme-options">
                  <div class="theme-option dark active" data-theme="dark" title="Dark Theme"></div>
                  <div class="theme-option blue" data-theme="blue" title="Blue Theme"></div>
                  <div class="theme-option purple" data-theme="purple" title="Purple Theme"></div>
                </div>
              </div>
            </div>
            
            <div class="preference-item">
              <div class="preference-info">
                <h4>Data Display Format</h4>
                <p>Choose how dates and numbers are displayed</p>
                <select id="date-format" class="form-select" style="width: 200px; margin-top: 10px;">
                  <option value="us">US Format (MM/DD/YYYY)</option>
                  <option value="eu">European Format (DD/MM/YYYY)</option>
                  <option value="iso" selected>ISO Format (YYYY-MM-DD)</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Support and Documentation Section -->
      <section class="card">
        <div class="card-header">
          <h2><i class="fas fa-question-circle"></i> Help & Documentation</h2>
        </div>
        
        <div class="card-body">
          <div class="action-buttons">
            <button id="open-documentation" class="btn btn-outline">
              <i class="fas fa-book"></i> View Documentation
            </button>
            <button id="contact-support" class="btn btn-outline">
              <i class="fas fa-envelope"></i> Contact Support
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="js/common.js"></script>
  <script src="js/api.js"></script>
  <script src="js/settings.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize UI elements
      updateSystemInformation();
      loadDashboardSummary();
      initializeClipboardButtons();
      initializeThemeSelectors();
      
      // Set up event listeners for export buttons (using existing functionality)
      document.getElementById('export-blacklist').addEventListener('click', function() {
        if (window.dashboardAPI && window.dashboardAPI.exportBlacklist) {
          dashboardAPI.exportBlacklist()
            .then(() => {
              DOM.showAlert('Blacklist exported successfully', 'success');
              document.getElementById('blacklist-last-export').textContent = `Last export: ${new Date().toLocaleString()}`;
            })
            .catch(error => {
              DOM.showAlert('Error exporting blacklist: ' + error.message, 'danger');
            });
        } else {
          window.location.href = 'blacklist.html'; // Fallback to blacklist page
        }
      });
      
      document.getElementById('export-whitelist').addEventListener('click', function() {
        if (window.dashboardAPI && window.dashboardAPI.exportWhitelist) {
          dashboardAPI.exportWhitelist()
            .then(() => {
              DOM.showAlert('Whitelist exported successfully', 'success');
              document.getElementById('whitelist-last-export').textContent = `Last export: ${new Date().toLocaleString()}`;
            })
            .catch(error => {
              DOM.showAlert('Error exporting whitelist: ' + error.message, 'danger');
            });
        } else {
          window.location.href = 'whitelist.html'; // Fallback to whitelist page
        }
      });
      
      document.getElementById('export-analytics').addEventListener('click', function() {
        if (window.dashboardAPI && window.dashboardAPI.exportAnalytics) {
          dashboardAPI.exportAnalytics()
            .then(() => {
              DOM.showAlert('Analytics data exported successfully', 'success');
              document.getElementById('analytics-last-export').textContent = `Last export: ${new Date().toLocaleString()}`;
            })
            .catch(error => {
              DOM.showAlert('Error exporting analytics: ' + error.message, 'danger');
            });
        } else {
          window.location.href = 'dashboard.html'; // Fallback to dashboard page
        }
      });
      
      // Toggle switches save to localStorage (client-side only, no backend needed)
      document.getElementById('auto-refresh-toggle').addEventListener('change', function(e) {
        localStorage.setItem('admin_auto_refresh', e.target.checked ? 'true' : 'false');
        DOM.showAlert('Preference saved', 'success');
      });
      
      document.getElementById('email-notifications-toggle').addEventListener('change', function(e) {
        localStorage.setItem('admin_email_notifications', e.target.checked ? 'true' : 'false');
        DOM.showAlert('Preference saved', 'success');
      });
      
      document.getElementById('date-format').addEventListener('change', function(e) {
        localStorage.setItem('admin_date_format', e.target.value);
        DOM.showAlert('Date format updated', 'success');
        // Refresh display
        updateSystemInformation();
      });
      
      // Initialize preference states from localStorage
      document.getElementById('auto-refresh-toggle').checked = 
        localStorage.getItem('admin_auto_refresh') !== 'false';
      document.getElementById('email-notifications-toggle').checked = 
        localStorage.getItem('admin_email_notifications') === 'true';
      document.getElementById('date-format').value = 
        localStorage.getItem('admin_date_format') || 'iso';
        
      // Help & Documentation buttons
      document.getElementById('open-documentation').addEventListener('click', function() {
        window.open('https://example.com/phishguard/docs', '_blank');
      });
      
      document.getElementById('contact-support').addEventListener('click', function() {
        window.location.href = 'contact.html';
      });
    });
    
    function updateSystemInformation() {
      // Update server time
      const now = new Date();
      const dateFormat = localStorage.getItem('admin_date_format') || 'iso';
      let formattedDate;
      
      switch(dateFormat) {
        case 'us':
          formattedDate = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()}, ${now.toLocaleTimeString()}`;
          break;
        case 'eu':
          formattedDate = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()}, ${now.toLocaleTimeString()}`;
          break;
        default: // iso
          formattedDate = now.toISOString().replace('T', ' ').slice(0, 19);
      }
      
      document.getElementById('serverTime').textContent = formattedDate;
      
      // Generate a fixed session ID for display
      const sessionId = localStorage.getItem('phishguard_admin_token') ? 
        `session-${Math.random().toString(36).substring(2, 10)}` : 'Not authenticated';
      document.getElementById('sessionID').textContent = sessionId;
      document.querySelector('[data-clipboard="session-xxxxxxxx"]').setAttribute('data-clipboard', sessionId);
      
      // Set last updated date
      document.getElementById('lastUpdated').textContent = '2023-07-01';
      
      // Update time periodically
      setTimeout(updateSystemInformation, 60000); // Update every minute
    }
    
    function loadDashboardSummary() {
      // Reuse dashboard data loading functionality
      if (window.dashboardAPI && window.dashboardAPI.getStats) {
        dashboardAPI.getStats()
          .then(stats => {
            document.getElementById('users-count-summary').textContent = stats.usersCount || 0;
            document.getElementById('whitelist-count-summary').textContent = stats.whitelistCount || 0;
            document.getElementById('blacklist-count-summary').textContent = stats.blacklistCount || 0;
            document.getElementById('scans-count-summary').textContent = stats.totalScans || 0;
          })
          .catch(error => {
            console.error('Failed to load dashboard summary:', error);
          });
      } else {
        // Dummy data as fallback
        document.getElementById('users-count-summary').textContent = '253';
        document.getElementById('whitelist-count-summary').textContent = '142';
        document.getElementById('blacklist-count-summary').textContent = '937';
        document.getElementById('scans-count-summary').textContent = '15,423';
      }
    }
    
    function initializeClipboardButtons() {
      document.querySelectorAll('.clipboard-button').forEach(button => {
        button.addEventListener('click', function() {
          const text = this.getAttribute('data-clipboard');
          navigator.clipboard.writeText(text).then(() => {
            // Change icon temporarily to show success
            const icon = this.querySelector('i');
            icon.className = 'fas fa-check';
            setTimeout(() => {
              icon.className = 'fas fa-copy';
            }, 1500);
          });
        });
      });
    }
    
    function initializeThemeSelectors() {
      document.querySelectorAll('.theme-option').forEach(option => {
        option.addEventListener('click', function() {
          const theme = this.getAttribute('data-theme');
          document.querySelectorAll('.theme-option').forEach(opt => {
            opt.classList.remove('active');
          });
          this.classList.add('active');
          localStorage.setItem('admin_theme', theme);
          DOM.showAlert('Theme preference saved', 'success');
          // In a real implementation, this would apply the theme
        });
      });
      
      // Set active theme from localStorage
      const savedTheme = localStorage.getItem('admin_theme') || 'dark';
      document.querySelectorAll('.theme-option').forEach(option => {
        if (option.getAttribute('data-theme') === savedTheme) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }
  </script>
</body>
</html>
